variables:
- group: GitHub SSH Key

jobs:
- job: BuildTemplate
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - task: InstallSSHKey@0
    inputs:
      sshKeySecureFile: id_sigbot_github_azure_devops
      hostName: $2048 SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8 github.com (RSA)
      sshPublicKey: 
  - checkout: self
  - bash: |
      sudo add-apt-repository ppa:team-gcc-arm-embedded/ppa
      sudo apt-get update
      sudo apt-get install gcc-arm-embedded
    displayName: Install gcc-arm-embedded
  - task: UsePythonVersion@0
    inputs:
      addToPath: true
      versionSpec: '3.6'
  - task: PipAuthenticate@0
    inputs:
      artifactFeeds: 'pros-cli'
  - bash: pip install pros-cli-v5
    displayName: Install CLI
  - bash: |
      make template
      mkdir -p artifacts
      cp template/*.zip artifacts
    displayName: Build template
  - task: PublishPipelineArtifact@0
    inputs:
      targetPath: artifacts
      artifactName: template
    condition: succeeded()